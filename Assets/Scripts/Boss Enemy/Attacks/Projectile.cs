using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class Projectile : MonoBehaviour
{
    // --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    // *               Public Fields                                                                                                                                                                                * 
    // --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    [Tooltip("Speed at which the projectile moves in Projectile_Direction.")]
    public float Projectile_Speed = 10f;
    [Tooltip("Period of time that the projectile can exist before it is deactivated.")]
    public float Projectile_Lifetime = 5f;

    // --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    // *               Private/Protected Attributes                                                                                                                                                                 * 
    // --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    private Vector3 Projectile_Direction;
    private ProjectilePool Projectile_HomePool;

    // --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    // *               Initialization                                                                                                                                                                               * 
    // --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    // Initializes the Projectile Game Object
    public void Initialize(ProjectilePool Projectile_Pool, Vector3 New_Direction)
    {
        // Set the target direction of the projectile
        Projectile_Direction = New_Direction.normalized;
        Invoke(nameof(DestroyProjectile), Projectile_Lifetime);

        // Update Projectile_HomePool
        Projectile_HomePool = Projectile_Pool;
    }

    // --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    // *               Projectile Value Update Functions                                                                                                                                                            * 
    // --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    public void UpdateAllProjectileValues(float New_ProjectileSpeed, float New_ProjectileLifetime)
    {
        UpdateProjectileSpeed(New_ProjectileSpeed);
        UpdateProjectileLifetime(New_ProjectileLifetime);
    }

    public void UpdateProjectileSpeed(float New_ProjectileSpeed)
    {
        Projectile_Speed = New_ProjectileSpeed;
    }

    public void UpdateProjectileLifetime(float New_ProjectileLifetime)
    {
        Projectile_Lifetime = New_ProjectileLifetime;
    }

    // --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    // *               Start Function                                                                                                                                                                               * 
    // --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    // Start is called before the first frame update
    void Start()
    {

    }

    // --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    // *               Update Function                                                                                                                                                                              * 
    // --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    // Update is called once per frame
    void Update()
    {

    }

    // --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    // *               Fixed Update Function                                                                                                                                                                        * 
    // --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    // FixedUpdate is called at set intervals
    void FixedUpdate()
    {
        MoveProjectile();
    }

    // --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    // *               Movement Functions                                                                                                                                                                           * 
    // --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    void MoveProjectile()
    {
        transform.position += Projectile_Direction * Projectile_Speed * Time.fixedDeltaTime;    // move towards Projectile_Direction at Projectile_Speed per second
    }

    // --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    // *               Destroy Functions                                                                                                                                                                            * 
    // --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    void DestroyProjectile()
    {
        Projectile_HomePool.ReturnProjectileToPool(gameObject);
    }
}
